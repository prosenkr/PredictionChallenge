---
title: "Prediction Challenge"
author: "Justin, Philipp, Fabian, Lennard, Paul"
date: "21.12.2022"
output: 
  pdf_document:
  #  toc: true
    number_sections: true
header-includes:
- \usepackage{graphicx}
- \usepackage{float}
- \usepackage{amsmath}
- \usepackage{dcolumn}
- \usepackage{biblatex}
#bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = FALSE, warning = FALSE)
library( tidyverse )
library( tidybayes )
library( funModeling ) 
library( scico ) 
library( ggrepel )
library( scico )
library( ggthemes )
library( patchwork )
library( haven )
library( tibble )
library( knitr )
library( tinytex )
library( sandwich )
library( lmtest )
library( stargazer )
library(tidymodels)
library(ISLR)
library(GGally)
library(broom)
library(dotwhisker)
library(performance)
library(funModeling)

options(digits = 3)
```

```{r, echo=FALSE}
rm(list=ls())
set.seed(1234)
options(scipen=10000)
select <- dplyr::select
```


\newpage
\tableofcontents

\newpage
\setlength{\parindent}{2em}
\baselineskip=1.5\baselineskip
\section{Introduction}

// Evidence from journals follows the statements made here.  
Over the past decade, the labour market has become increasingly tight. Companies have strong difficulties to find matching and convincing professionals and spend an enormous amount of their investments in employee marketing and active sourcing. 
The tension on the labour market is also noticeable on the yachting and luxury shipping branch. M Yachts, a charter platform to book yachting experiences is highly affected by the described development. In addition, the yachting industry is affected by a high turnover of personnel working as crew members on boats and has very demanding and exclusive customers. For this reason, it is even more difficult to find suitable employees for companies in the yachting industry such as M Yachts. 
Version 1: This paper addresses the research question how to predict how well an applicant will fit into M Yachts?
Version 2: The paper gives a solution to how well new applicants fit to the company M Yachts by using machine learning approaches. 
The predicted fit of the applicant is given by a star rating between zero and five, where five is a perfect fit and zero represents the lowest matching. To achieve this objective, a dataset of several applicants and their star ratings, as determined by a recruiter, was provided. Furthermore, the motivation of the paper is to lean the application process to reduce costs on the one hand and provide an objective judgment to improve the quality of the employees on the yachts on the other hand. 
The article is written in course of the module Machine Learning at the University of Cologne, held by Prof. Dr. Markus Weinmann, in cooperation with the company M Yachts. Applying the main concepts of machine learning and analysing results of them are goals of the module. The assignment faces exactly these competencies and applies them to the practical problem of M Yachts. 
First, the paper deals with the exploratory data analysis and describes the characteristics of the given data set. Second, different machine learning methods are presented to find the best prediction whether an applicant fits to M Yachts or not. After introducing the most important findings a discussion about both the usability and meaningfulness and the ethical applicability follows. In the end, the article gives an outlook to illuminate the extensibility of the data set and the potential of implementing other Machine Learning Tools to improve the application process.

\section{Dataset}

To ensure that the data used for training machine learning models is accurate and properly formatted, we perform an exploratory data analysis (EDA) and data wrangling as first step.

\subsection{Exploratory Data Analysis (EDA)}

EDA involves analyzing and summarizing the characteristics of a dataset, identifying patterns and anomalies, and visualizing the data to gain insights. This helps to understand the data and identify any potential issues that may affect the accuracy of the used models. First, we load the dataset provided by MYachts and prepare it for the EDA by renaming and mutating variables. In addition, we deselect certain variables that are not suitable as predictors and therefore, not relevant for our first analysis.

\subsection{Variables of interest}
Explain: what makes a variable interesting? 
Table which are interesting?
Show that we have very less data  data extension 

```{r}
# Load raw dataset
mycrew <- read.csv("MyCrew Data_221208.csv")
```

```{r}
df <- read.csv("myachts_extended.csv", na.strings = c("", "NA","na", "n/a", "N/A")) %>%     
  mutate( StarRating = ifelse(StarRating == "OneStarReview",1,
                       ifelse(StarRating == "TwoStarReview",2,
                       ifelse(StarRating == "ThreeStarReview", 3,
                       ifelse(StarRating == "FourStarReview", 4,
                       ifelse(StarRating == "FiveStarReview", 5,
                       ifelse(StarRating == "NotSuitable", 0,"NA")))))) ) %>%      
                                                            #InProgress deleted
    rename(Region = Economic.Region,
         Pop = Population..2020.,
         Coastline = Coastline.WRI..km.,
         CoastRatio = Coast.Area.Ratio..WRI...m.km2.,
         Happiness = Happiness.Report,
         GDP = GWP.Per.Capita..2020.) %>%
  
  mutate(StarRating = as.numeric(StarRating),
         CurrentCompany = as.factor(CurrentCompany),
         CurrentRole = as.factor(CurrentRole),
         IsTempProfile = as.factor(IsTempProfile),
         WorkerJobSearchStatus = as.factor(WorkerJobSearchStatus),
         ConnectionPipelineStatus = as.factor(ConnectionPipelineStatus),
         ProfileAddedAt = as.factor(ProfileAddedAt),
         ProfileAddedBy = as.factor(ProfileAddedBy),
         TalentCommunitySource = as.factor(TalentCommunitySource),
         State = as.factor(State),
         Country = as.factor(Country),
         City = as.factor(City),
         Postcode = as.factor(Postcode),
         LastCommunicatedAt = as.factor(LastCommunicatedAt),
         LastCommunicatedBy = as.factor(LastCommunicatedAt),
         Region = as.factor(Region),
         Pop = as.numeric(stri_replace_all_regex(Pop,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         Happiness = as.numeric(stri_replace_all_regex(Happiness,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         Coastline = as.numeric(stri_replace_all_regex(Coastline,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         CoastRatio = as.numeric(stri_replace_all_regex(CoastRatio,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         GDP = as.numeric(stri_replace_all_regex(GDP,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE))) %>%
  
  mutate(Region_edited = ifelse(Country == "Canada", "North America",
                         ifelse(Country == "United States", "North America",
                         ifelse(Region == "APAC", "APAC",
                         ifelse(Region == "LATAM", "LATAM",
                         ifelse(Region == "EMEA", "EMEA", "NA")))))) %>%
  mutate(Region_edited = as.factor(Region_edited))

  

#How to convert European numbers format
#test <- df %>%
#  mutate(new = gsub("\\.","",Pop)) %>%
#  mutate(new2 = gsub(",", ".", new)) %>%
#  mutate(new3 = stri_replace_all_regex(Pop,             #combines step 1+2
#                                  pattern=c("\\.", ","),
#                                  replacement=c("", "."),
#                                  vectorize=FALSE)) %>%
#  select(Pop, new, new2, new3)

```

```{r}
summary(df)

#Expected:
#Region: 2643
#Pop: 2641
#Coastline: 2616
#CoastRatio: 2616
#Happiness: 2593
#GDP: 2623
```

#Select varibales of interest
#Remove NAs
```{r}
df2 <- df %>%
  select(StarRating, CurrentCompany, CurrentRole, Country, Region_edited,
         Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)

complete_data <- na.omit(df2)
summary(complete_data)
```
```{r}
basic_eda <- function(data)
{
  glimpse(data)
  print(status(data))
  freq(data) 
  print(profiling_num(data))
  plot_num(data)
  describe(data)
}

basic_eda(complete_data)
```


#Convert CurrentRole to 6 level factor
```{r}
#Define patterns (create more to reduce "others") to match CurrentRole with
#job categories:
#- Allrounder (if more than one job category is specified)
#- Captain
#- Deckhand
#- Engineer
#- Chef
#- Steward

chef <- c("chef", "cook", "jefe", "cocina", "kitch")
engineer <- c("neer", "tech", "engin")
deckhand <- c("deck", "bosun")
unemployed <- c("unempl", "seeking", "jobless", "search", "none")

df3 <- complete_data %>%
  mutate(Job = ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE ,
                      "Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(chef, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder", 
                      #---------------------------------------------------------
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl("stew", CurrentRole, ignore.case = TRUE)) 
                      == TRUE , "Allrounder",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(deckhand, collapse = "|"),  
                      CurrentRole, ignore.case = TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(chef, collapse = "|"), CurrentRole, 
                      ignore.case = TRUE)) == TRUE , "Allrounder", 
                      #--------------------------------------------------------
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE , "Allrounder",
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(chef, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE , "Allrounder", 
                      #--------------------------------------------------------
               ifelse((grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(chef, collapse = "|"), CurrentRole, 
                      ignore.case = TRUE)) == TRUE ,"Allrounder", 
                      
               #Next: assign jobs by finding key words in CurrentRole
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE,"Captain",
               ifelse((grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Deckhand",
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE,"Steward",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Engineer",
               ifelse((grepl(paste(chef, collapse ="|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Chef",
               ifelse((grepl(paste(unemployed, collapse ="|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE, "Unemployed", "Other"))))))))))))))))) %>%
  
  mutate(Job = as.factor(Job)) %>%
  select(CurrentRole, Job, StarRating, CurrentCompany, Country, Region_edited, 
         Region_edited, Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)

```


```{r}
summary(df3$Job) #including two new variables provided by MYachts (esp. Experience) reduces n by ~500

#Ideas:
#add key words in multiple languages
#Officer
#Student / Master
#Cabin Crew
#Flight attendant
#prestige: senior, first, 1st, director, leader, head, chief
```

```{r}
#Define industries
airline <- c("line", "air", "wings", "ryanair", "easyjet", "jet", "fly", "flight")
yachting <- c("yach", "boat", "chart", "ship", "crew", "sail", "ocean", "farry",
              "coast", "cruise", "wave", "motor", "acht", "yac", "yate", "barco",
              "water", "nautic", "ferrie", "freight", "cargo", "royal caribbean",
              "10m", "20m", "30m", "40m", "50m", "46m", "55m", "100m", "107m", "M/Y")
hotel <- c("hotel", "hyatt", "hilton", "resort", "lux", "accom")
gastro <- c("restaurant", "baker", "bar", "food", "ristorante", "caffe", "coffe",
            "steak", "cafe", "beef", "cake", "catering", "chef", "burger",
            "gastro", "Café", "cook", "breakfast", "mcdonald")
defence <- c("minist", "defenc", "marine", "navy", "force", "army", "marit",
             "safety", "security", "red cross")
freelance <- c("freelance", "self", "free lance")
#chains <- c("ryanair", "walmart", "carrefour", "easyjet")


df4 <- df3 %>%
  mutate(Industry = 
           ifelse((grepl(paste(yachting, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"yachting",
           ifelse((grepl(paste(gastro, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"gastro",
           ifelse((grepl(paste(hotel, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"hotel",
           ifelse((grepl(paste(defence, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"defence",
           ifelse((grepl(paste(freelance, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"freelance",
           ifelse((grepl(paste(airline, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"airline", "Other"))))))) %>%
             
  mutate(Industry = as.factor(Industry)) %>%
  mutate(TalentSource = ifelse(TalentCommunitySource == "LinkedIn", "LinkedIn",
                        ifelse(TalentCommunitySource == "Careers Website",
                               "Careers Website",
                        ifelse(TalentCommunitySource == "Indeed","Indeed",
                        ifelse((grepl("linked", TalentCommunitySource, 
                                      ignore.case = TRUE)) == TRUE, "LinkedIn",
                        ifelse((grepl("google", TalentCommunitySource, 
                                      ignore.case = TRUE)) == TRUE, "Google",
                        ifelse((grepl("crew", TalentCommunitySource,
                                     ignore.case = TRUE)) == TRUE, "my-crew.com", 
                        "Other"))))))) %>%
  select(CurrentRole, Job, StarRating, CurrentCompany, Industry, Country, Region_edited, 
         Region_edited, Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)
```


```{r}
summary(df4$Industry)
```
#Exploratory data analysis

```{r}
#Create descriptive statistics (mean, min, max, sd, n)
#StarRating per job category
n <- df4 %>%
  count(Job)

(descriptive_rating_per_job <- df4 %>%
  group_by(Job) %>%
  summarise(meanRating = mean(StarRating),
            minRating = min(StarRating),
            maxRating = max(StarRating),
            sdRating = sd(StarRating)) %>%
  arrange(desc(meanRating)) %>%
  select(Job, meanRating, minRating, maxRating, sdRating))

rating_per_job <- left_join(descriptive_rating_per_job, n, by= "Job")

#Visualize------------------------------------------------------------------
ggplot(rating_per_job, aes(Job, meanRating))+
  geom_bar(stat = "identity")

ggplot(rating_per_job, aes(Job, meanRating))+
  geom_boxplot()


#Experience per job category
(descriptive_exp_per_job <- df4 %>%
  group_by(Job) %>%
  summarise(meanExp = mean(ExperienceYears),
            minExp = min(ExperienceYears),
            maxExp = max(ExperienceYears),
            sdExp = sd(ExperienceYears)) %>%
  arrange(desc(meanExp)) %>%
  select(Job, meanExp, minExp, maxExp, sdExp))
exp_per_job <- left_join(descriptive_exp_per_job, n, by="Job")


```

#Next:
#CV strength per job
#Job and origin
#avg rating per origin
#rating per industry
#rating per job + exp
#distribution of countries (world map)

\section{Methods}
To really understand what machine learning methods are used and how they work, it is important to first understand what machine learning is: 
Machine learning is a subfield of artificial intelligence that involves the development of algorithms and models that can learn from and make predictions or decisions based on data. These algorithms and models are able to improve their performance over time as they are exposed to more data.

In machine learning, algorithms are trained on a dataset, which consists of a collection of examples that include input data and the corresponding correct output. The algorithm uses this training data to learn how to map the input data to the correct output. Once the algorithm has learned from the training data, it can then be applied to new, unseen data to make predictions or decisions.

There are several different types of machine learning, including supervised learning and unsupervised learning. Supervised learning involves training an algorithm on labeled data, where the correct output is provided for each example in the training data. Unsupervised learning comprises training an algorithm on unlabeled data, where the algorithm must discover the underlying structure of the data on its own.

\subsection{Supervised}
In supervised learning, the training data consists of a set of input-output pairs. The algorithm uses these pairs to learn the relationship between the input and the output. Once the algorithm has learned this relationship, it can then be applied to new, unseen input data to predict the corresponding output.

Examples of supervised learning tasks include classification, where the goal is to predict a class label for a given input data, and regression, where the objective is to predict a continuous output value.

Supervised learning is widely used in many applications, such as image classification, spam detection, and stock price prediction. It is a powerful tool for solving problems that require the prediction of a specific output value based on input data.

\subsubsection{Classification}
In classification, the input data is usually represented as a set of features, which are attributes or characteristics of the data.
The class label is the output that the algorithm is trying to predict. For example, in a binary classification problem, there are only two possible class labels (e.g., spam or not spam). In a multi-class classification problem, there are more than two possible class labels.

The goal of the paper is to predict the star rating of the given data set which is a multi-class classification with markedness from zero to five. Thus, different classification methods could be a good approach to find an answer to the research question. 

\subsubsubsection{Decision Tree}
A decision works by creating a tree-like model of decisions and their possible consequences. The tree is created by splitting the data into smaller and smaller subsets based on certain feature values. At each node in the tree, the model makes a decision based on the value of a certain feature and directs the data to the right branch of the tree. The final decision at the end of the tree is the predicted outcome.

Decision trees are easy to understand and interpret, and they can handle both continuous and categorical data. However, they can be prone to overfitting and may not always perform as well as other machine learning algorithms.
\subsubsubsection{Extreme Gradient Boosting XGBoosting}

\subsubsubsection{Random Forrest}
\subsubsubsection{Naive Bayes}
\subsubsubsection{Logistic Regression}
\subsubsection{Regression}
\subsubsubsection{Linear Regression}

\subsection{Unsupervised}
Unsupervised learning is a type of machine learning in which the model is not given any labeled training data. Instead, the model must find patterns and relationships in the data on its own. This is in contrast to supervised learning, in which the model is given labeled training data and learns to make predictions based on that data.

Unsupervised learning is useful for exploring and understanding the structure of a dataset, and it can be used to generate new features or to identify patterns that may not be apparent in the raw data. However, it is generally less accurate than supervised learning and requires more data to be effective.

The machine learning field can be divided into dimensionality reduction and clustering 
\subsubsection{Dimensionality Reduction}
Principal Component Analysis:

\subsubsection{Clustering}
\subsubsubsection{K-Means}

\section{Results}
Model evaluation and results of the different models
Which algorithm/ML method has the best accuracy? 

Why do we choose it and what could we change? 


\subsection{Plots}

\section{Discussion}
What challenges did we face in the prediction challenge? 
Data lack  potential
\subsection{Challenges}
\subsection{Ethics}
Ethics (country and crime rate as predictor) 
\subsection{Outlook}
How to improve the application process? 
\newpage
\section{Evaluation of examination results}

\begin{enumerate}

\item \textbf{Same grade: We confirm that each student from our group has contributed equally to the project.}


  \begin{tabular}{@{}p{7cm}p{5cm}@{}}
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \end{tabular}
\\


\item \textbf{Individual grades: We request individual grades for each student from our group.}

Please describe \textbf{in detail} the contributions of each group member in the following:


\textit{Student 1:}
    
  \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
 \newline 
 
\textit{Student 2:}
  
    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
 \newline 
 
\textit{Student 3:}

    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
\newline

\textit{Student 4:}
  
    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}


\end{enumerate}

\newpage
\section{Bibliography}


\setlength{\parindent}{0em}



