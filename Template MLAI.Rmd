---
title: "Prediction Challenge"
author: "Justin, Philipp, Fabian, Lennard, Paul"
date: "21.12.2022"
output: 
  pdf_document:
  #  toc: true
    number_sections: true
header-includes:
- \usepackage{graphicx}
- \usepackage{float}
- \usepackage{amsmath}
- \usepackage{dcolumn}
- \usepackage{biblatex}
#bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, message = FALSE, warning = FALSE)
library( tidyverse )
library( tidybayes )
library( funModeling ) 
library( scico ) 
library( ggrepel )
library( scico )
library( ggthemes )
library( patchwork )
library( haven )
library( tibble )
library( knitr )
library( tinytex )
library( sandwich )
library( lmtest )
library( stargazer )
library(tidymodels)
library(ISLR)
library(GGally)
library(broom)
library(dotwhisker)
library(performance)
library(funModeling)

options(digits = 3)
```


\newpage
\tableofcontents

\newpage
\setlength{\parindent}{2em}
\baselineskip=1.5\baselineskip
\section{Introduction}

Over the past decade, the labour market has become increasingly tight. Companies have strong difficulties to find matching and convincing professionals and spend an enormous amount of their investments in employee marketing and active sourcing.  

The tension on the labour market is also noticeable on the yachting and luxury shipping branch. M Yachts, a charter platform to book yachting experiences is highly affected by the described development. In addition, the yachting industry is affected by a high turnover of personnel working as crew members on boats and has very demanding and exclusive customers. For this reason, it is even more difficult to find suitable employees for companies in the yachting industry such as M Yachts.  

This paper gives a solution to how well new applicants fit to the company M Yachts by using machine learning approaches. The predicted fit of the applicant is given in percent where 100% are a perfect fit and 0% is represents the lowest matching. To achieve this objective, a dataset of several applicants and their performance ratings, as determined by a recruiter, was provided. Furthermore, the motivation of the paper is to lean the application process to reduce costs on the one hand and provide an objective judgment to improve the quality of the employees on the yachts on the other hand.  

The article is written for the module Machine Learning at the University of Cologne, held by Prof. Dr. Markus Weinmann, in cooperation with the company M Yachts. 

First, the paper deals with the exploratory data analysis and describes the characteristics of the given data set. Second, different machine learning methods are presented to find the best prediction whether an applicant fits to M Yachts or not. After introducing the most important findings a discussion about both the usability and meaningfulness and the ethical applicability follows. In the end, the article gives an outlook to illuminate the extendibility of the data set and the potential of implementing other Machine Learning Tools to improve the application process. 

\section{Methods}
How to compute a numeric list:

```{r}
df <- read.csv("myachts_extended.csv", na.strings = c("", "NA")) %>%     
  mutate( StarRating = ifelse(StarRating == "OneStarReview",1,
                       ifelse(StarRating == "TwoStarReview",2,
                       ifelse(StarRating == "ThreeStarReview", 3,
                       ifelse(StarRating == "FourStarReview", 4,
                       ifelse(StarRating == "FiveStarReview", 5,
                       ifelse(StarRating == "NotSuitable", 0,"NA")))))) ) %>%      
                                                            #InProgress deleted
    rename(Region = Economic.Region,
         Pop = Population..2020.,
         Coastline = Coastline.WRI..km.,
         CoastRatio = Coast.Area.Ratio..WRI...m.km2.,
         Happiness = Happiness.Report,
         GDP = GWP.Per.Capita..2020.) %>%
  
  mutate(StarRating = as.numeric(StarRating),
         CurrentCompany = as.factor(CurrentCompany),
         CurrentRole = as.factor(CurrentRole),
         IsTempProfile = as.factor(IsTempProfile),
         WorkerJobSearchStatus = as.factor(WorkerJobSearchStatus),
         ConnectionPipelineStatus = as.factor(ConnectionPipelineStatus),
         ProfileAddedAt = as.factor(ProfileAddedAt),
         ProfileAddedBy = as.factor(ProfileAddedBy),
         TalentCommunitySource = as.factor(TalentCommunitySource),
         State = as.factor(State),
         Country = as.factor(Country),
         City = as.factor(City),
         Postcode = as.factor(Postcode),
         LastCommunicatedAt = as.factor(LastCommunicatedAt),
         LastCommunicatedBy = as.factor(LastCommunicatedAt),
         Region = as.factor(Region),
         Pop = as.numeric(stri_replace_all_regex(Pop,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         Happiness = as.numeric(stri_replace_all_regex(Happiness,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         Coastline = as.numeric(stri_replace_all_regex(Coastline,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         CoastRatio = as.numeric(stri_replace_all_regex(CoastRatio,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE)),
         GDP = as.numeric(stri_replace_all_regex(GDP,
                                  pattern=c("\\.", ","),
                                  replacement=c("", "."),
                                  vectorize=FALSE))) %>%
  
  mutate(Region_edited = ifelse(Country == "Canada", "North America",
                         ifelse(Country == "United States", "North America",
                         ifelse(Region == "APAC", "APAC",
                         ifelse(Region == "LATAM", "LATAM",
                         ifelse(Region == "EMEA", "EMEA", "NA")))))) %>%
  mutate(Region_edited = as.factor(Region_edited))

  

#How to convert European numbers format
#test <- df %>%
#  mutate(new = gsub("\\.","",Pop)) %>%
#  mutate(new2 = gsub(",", ".", new)) %>%
#  mutate(new3 = stri_replace_all_regex(Pop,             #combines step 1+2
#                                  pattern=c("\\.", ","),
#                                  replacement=c("", "."),
#                                  vectorize=FALSE)) %>%
#  select(Pop, new, new2, new3)

```

```{r}
summary(df)

#Expected:
#Region: 2643
#Pop: 2641
#Coastline: 2616
#CoastRatio: 2616
#Happiness: 2593
#GDP: 2623
```

#Select varibales of interest
#Remove NAs
```{r}
df2 <- df %>%
  select(StarRating, CurrentCompany, CurrentRole, Country, Region_edited,
         Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)

complete_data <- na.omit(df2)
summary(complete_data)
```
```{r}
basic_eda <- function(data)
{
  glimpse(data)
  print(status(data))
  freq(data) 
  print(profiling_num(data))
  plot_num(data)
  describe(data)
}

basic_eda(complete_data)
```


#Convert CurrentRole to 6 level factor
```{r}
#Define patterns (create more to reduce "others") to match CurrentRole with
#job categories:
#- Allrounder (if more than one job category is specified)
#- Captain
#- Deckhand
#- Engineer
#- Chef
#- Steward

chef <- c("chef", "cook", "jefe", "cocina", "kitch")
engineer <- c("neer", "tech", "engin")
deckhand <- c("deck", "bosun")
unemployed <- c("unempl", "seeking", "jobless", "search", "none")

df3 <- complete_data %>%
  mutate(Job = ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE ,
                      "Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(chef, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE ,"Allrounder", 
                      #---------------------------------------------------------
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl("stew", CurrentRole, ignore.case = TRUE)) 
                      == TRUE , "Allrounder",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(deckhand, collapse = "|"),  
                      CurrentRole, ignore.case = TRUE)) == TRUE ,"Allrounder",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(chef, collapse = "|"), CurrentRole, 
                      ignore.case = TRUE)) == TRUE , "Allrounder", 
                      #--------------------------------------------------------
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE , "Allrounder",
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE &
                      (grepl(paste(chef, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE , "Allrounder", 
                      #--------------------------------------------------------
               ifelse((grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                      TRUE)) == TRUE & (grepl(paste(chef, collapse = "|"), CurrentRole, 
                      ignore.case = TRUE)) == TRUE ,"Allrounder", 
                      
               #Next: assign jobs by finding key words in CurrentRole
               ifelse((grepl("tain", CurrentRole, ignore.case = TRUE)) == TRUE,"Captain",
               ifelse((grepl(paste(deckhand, collapse = "|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Deckhand",
               ifelse((grepl("stew", CurrentRole, ignore.case = TRUE)) == TRUE,"Steward",
               ifelse((grepl(paste(engineer, collapse = "|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Engineer",
               ifelse((grepl(paste(chef, collapse ="|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE,"Chef",
               ifelse((grepl(paste(unemployed, collapse ="|"), CurrentRole, ignore.case = 
                     TRUE)) == TRUE, "Unemployed", "Other"))))))))))))))))) %>%
  
  mutate(Job = as.factor(Job)) %>%
  select(CurrentRole, Job, StarRating, CurrentCompany, Country, Region_edited, 
         Region_edited, Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)

```


```{r}
summary(df3$Job) #including two new variables provided by MYachts (esp. Experience) reduces n by ~500

#Ideas:
#add key words in multiple languages
#Officer
#Student / Master
#Cabin Crew
#Flight attendant
#prestige: senior, first, 1st, director, leader, head, chief
```

```{r}
#Define industries
airline <- c("line", "air", "wings", "ryanair", "easyjet", "jet", "fly", "flight")
yachting <- c("yach", "boat", "chart", "ship", "crew", "sail", "ocean", "farry",
              "coast", "cruise", "wave", "motor", "acht", "yac", "yate", "barco",
              "water", "nautic", "ferrie", "freight", "cargo", "royal caribbean",
              "10m", "20m", "30m", "40m", "50m", "46m", "55m", "100m", "107m", "M/Y")
hotel <- c("hotel", "hyatt", "hilton", "resort", "lux", "accom")
gastro <- c("restaurant", "baker", "bar", "food", "ristorante", "caffe", "coffe",
            "steak", "cafe", "beef", "cake", "catering", "chef", "burger",
            "gastro", "Café", "cook", "breakfast", "mcdonald")
defence <- c("minist", "defenc", "marine", "navy", "force", "army", "marit",
             "safety", "security", "red cross")
freelance <- c("freelance", "self", "free lance")
#chains <- c("ryanair", "walmart", "carrefour", "easyjet")


df4 <- df3 %>%
  mutate(Industry = 
           ifelse((grepl(paste(yachting, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"yachting",
           ifelse((grepl(paste(gastro, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"gastro",
           ifelse((grepl(paste(hotel, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"hotel",
           ifelse((grepl(paste(defence, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"defence",
           ifelse((grepl(paste(freelance, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"freelance",
           ifelse((grepl(paste(airline, collapse = "|"), CurrentCompany, ignore.case = 
           TRUE)) == TRUE,"airline", "Other"))))))) %>%
             
  mutate(Industry = as.factor(Industry)) %>%
  mutate(TalentSource = ifelse(TalentCommunitySource == "LinkedIn", "LinkedIn",
                        ifelse(TalentCommunitySource == "Careers Website",
                               "Careers Website",
                        ifelse(TalentCommunitySource == "Indeed","Indeed",
                        ifelse((grepl("linked", TalentCommunitySource, 
                                      ignore.case = TRUE)) == TRUE, "LinkedIn",
                        ifelse((grepl("google", TalentCommunitySource, 
                                      ignore.case = TRUE)) == TRUE, "Google",
                        ifelse((grepl("crew", TalentCommunitySource,
                                     ignore.case = TRUE)) == TRUE, "my-crew.com", 
                        "Other"))))))) %>%
  select(CurrentRole, Job, StarRating, CurrentCompany, Industry, Country, Region_edited, 
         Region_edited, Happiness, Coastline, CoastRatio, TalentCommunitySource, 
         GDP, Pop, ExperienceYears, CvStrength)
```


```{r}
summary(df4$Industry)
```
#Exploratory data analysis

```{r}
#Create descriptive statistics (mean, min, max, sd, n)
#StarRating per job category
n <- df4 %>%
  count(Job)

(descriptive_rating_per_job <- df4 %>%
  group_by(Job) %>%
  summarise(meanRating = mean(StarRating),
            minRating = min(StarRating),
            maxRating = max(StarRating),
            sdRating = sd(StarRating)) %>%
  arrange(desc(meanRating)) %>%
  select(Job, meanRating, minRating, maxRating, sdRating))

rating_per_job <- left_join(descriptive_rating_per_job, n, by= "Job")

#Visualize------------------------------------------------------------------
ggplot(rating_per_job, aes(Job, meanRating))+
  geom_bar(stat = "identity")

ggplot(rating_per_job, aes(Job, meanRating))+
  geom_boxplot()


#Experience per job category
(descriptive_exp_per_job <- df4 %>%
  group_by(Job) %>%
  summarise(meanExp = mean(ExperienceYears),
            minExp = min(ExperienceYears),
            maxExp = max(ExperienceYears),
            sdExp = sd(ExperienceYears)) %>%
  arrange(desc(meanExp)) %>%
  select(Job, meanExp, minExp, maxExp, sdExp))
exp_per_job <- left_join(descriptive_exp_per_job, n, by="Job")


```

#Next:
#CV strength per job
#Job and origin
#avg rating per origin
#rating per industry
#rating per job + exp
#distribution of countries (world map)
```{r}
\begin{enumerate} 
  \item Number 1 on your list
  \item Number 2 on your list
\end{enumerate}

\subsection{Study Design} 

How to compute a list
\begin{itemize}
\item Bulletpoint 1
\item Bulletpoint 2
\end{itemize}

\subsection{Method}



\section{Results}


\subsection{Plots}

\section{Discussion}

\newpage
\section{Evaluation of examination results}

\begin{enumerate}

\item \textbf{Same grade: We confirm that each student from our group has contributed equally to the project.}


  \begin{tabular}{@{}p{7cm}p{5cm}@{}}
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \\
  \hrulefill \\
  (Name, matriculation No.) \\
  \end{tabular}
\\


\item \textbf{Individual grades: We request individual grades for each student from our group.}

Please describe \textbf{in detail} the contributions of each group member in the following:


\textit{Student 1:}
    
  \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
 \newline 
 
\textit{Student 2:}
  
    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
 \newline 
 
\textit{Student 3:}

    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}
\newline

\textit{Student 4:}
  
    \begin{tabular}{@{}p{7cm}p{5cm}@{}}
     \\
     \hrulefill \\
      (Signature)
   \end{tabular}


\end{enumerate}

\newpage
\section{Bibliography}


\setlength{\parindent}{0em}



